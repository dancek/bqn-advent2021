in â† â€¢FChars "16.txt"

Match â† {ğ•ğ•¨}Â´
While â† {ğ•©{ğ”½âŸğ”¾âˆ˜ğ”½_ğ•£_ğ”¾âˆ˜ğ”½âŸğ”¾ğ•©}ğ•¨@}Â´

Bits â† {>8â€¿4â€¿2â€¿1Â¨{mâ†ğ”½ğ•© â‹„ mâ‰¤(2Ã—m)|ğ•©} -âŸœ{7Ã—âŒŠğ•©Ã·16}ğ•©-'0'}
data â† âˆ¾Â´BitsÂ¨in

Int â† {+Â´ğ•©Ã—âŒ½2â‹†â†•â‰ ğ•©}

ReadLiteralBits â† {
  tâ€¿s â† 5 (â†‘â‹ˆâ†“) ğ•©
  bs â† 1â†“t
  { (Â¬âŠ‘t) ? bsâ€¿s ;
    tâ€¿s â† ReadLiteralBits s
    (bsâˆ¾t)â€¿s
  }
}
ReadLiteral â† {
  bsâ€¿s â† ReadLiteralBits ğ•©
  (Int bs)â€¿s
}

ReadOp â† {
  (âŠ‘ğ•©) ?
    # type 1: l is number of packets
    tâ€¿subs â† @â€¿âŸ¨âŸ©
    lâ€¿s â† 11 (â†‘â‹ˆâ†“) 1â†“ğ•©
    l â†© (Int l)
    While {ğ•¤ â‹„ l>0}â€¿{ğ•¤
      l -â†© 1
      tâ€¿s â†© ReadPacket s
      subs âˆ¾â†© <t
    }
    subsâ€¿s
  ;
    # type 0: l is number of bits
    tâ€¿ssâ€¿subs â† @â€¿@â€¿âŸ¨âŸ©
    lâ€¿s â† 15 (â†‘â‹ˆâ†“) 1â†“ğ•©
    ssâ€¿s â†© (Int l) (â†‘â‹ˆâ†“) s
    (ReadPackets ss)â€¿s
}

vsum â† 0
ReadPacket â† {ğ•Š s:
  dâ†vâ†tâ†@
  vâ€¿s â†© 3 (â†‘â‹ˆâ†“) s
  tâ€¿s â†© 3 (â†‘â‹ˆâ†“) s
  dâ€¿s â†© Match (Int t)â€¿{
    4: ReadLiteral s ;
    ğ•©: ReadOp s
  }
  vsum +â†© (Int v)
  ((Int v)â€¿(Int t)â€¿d)â€¿s
}
ReadPackets â† {ğ•Š s:
  pâ€¿ps â† @â€¿âŸ¨âŸ©
  # under 11 bits is always padding (header is 3+3 and shortest data 5 bits)
  While {ğ•¤ â‹„ 11â‰¤â‰ s}â€¿{ğ•¤
    pâ€¿s â†© ReadPacket s
    ps âˆ¾â†© <p
  }
  ps
}
ast â† ReadPackets data
â€¢Show vsum

Eval â† {
  ğ•Š vâ€¿4â€¿data: data ;
  ğ•Š vâ€¿tâ€¿data: (t âŠ‘ +â€¿Ã—â€¿âŒŠâ€¿âŒˆâ€¿@â€¿>â€¿<â€¿=)Â´EvalÂ¨data
}
â€¢Show Eval âŠ‘ast

