in â† â€¢FLines "18.txt"

_fix â† {ğ•©â‰¡ğ•¨ğ”½ğ•© ? ğ•© ; ğ•¨ğ•Šğ•¨ğ”½ğ•©}

ParseLine â† {ğ•Š line:
  depth â† 0
  arr â† âŸ¨âŸ©
  {'[': depth +â†© 1;
   ']': depth -â†© 1;
   ',': 0;
   arr âˆ¾â†© <depthâ€¿(ğ•©-'0')
  }Â¨line
  >arr
}

Display â† {ğ•Š arr:
  s â† ""
  idx â† 0
  depth â† 0
  {ğ•Š dâ€¿v:
    {d â‰  depth ?
      s âˆ¾â†© (|d-depth)â¥Š{d>depth ? '[' ; ']'}
      depth â†© d
    ; @}
    s âˆ¾â†© '0'+v
    @
  }Ë˜arr
  s âˆ¾ depthâ¥Š']'
}

Explode â† {ğ•Š data:
  l â† â‰ data
  i â† âŠ‘âŠâŸœ1 (5âŠ¸â‰¤âˆ§Â«=âŠ¢) âŠË˜data
  {i=l ? data;
    d â† âŠ‘iâŠdata
    V â† {ğ•©â€¿1âŠ‘data}
    head â† {0<i ? ((i-1)â†‘data) âˆ¾ (0â€¿(V i))+(i-1)âŠdata; â†•0â€¿2}
    tail â† {l>i+2 ? ((0â€¿(V i+1))+(i+2)âŠdata) âˆ¾ (i+3)â†“data; â†•0â€¿2}
    head âˆ¾ âŸ¨d-1,0âŸ© âˆ¾ tail
  }
}

Split â† {ğ•Š data:
  i â† âŠ‘âŠâŸœ1 9<1âŠË˜data
  {i=â‰ data ? data;
    dâ€¿v â† iâŠdata
    a â† âŒŠvÃ·2
    b â† âŒˆvÃ·2
    (iâ†‘data) âˆ¾ (d+1)â€¿a âˆ¾ (d+1)â€¿b âˆ¾ ((i+1)â†“data)}
}
Reduce â† (Split Explode _fix) _fix

Add â† {Reduce 1â€¿0âŠ¸+Ë˜ğ•©âˆ¾ğ•¨}Â´âŒ½

Magnitude1 â† {ğ•Š data:
  {1=â‰ data ? data ;
    m â† âŒˆÂ´âŠË˜data
    i â† âŠ‘âŠâŸœ1 m=âŠË˜data
    dâ€¿a â† iâŠdata
    Â·â€¿b â† (i+1)âŠdata
    
    (iâ†‘data) âˆ¾ (d-1)â€¿((3Ã—a)+2Ã—b) âˆ¾ ((i+2)â†“data)}
}
Magnitude â† 0â€¿1âŠ‘ Magnitude1 _fix

dsâ†ParseLineÂ¨in
â€¢Show Magnitude Add ds

pairs â† âˆ¾Â´{ğ•©âˆ¾Â¨â†•ğ•©}Â¨â†•â‰ ds
â€¢Show âŒˆÂ´â¥ŠMagnitudeâˆ˜Addâˆ˜âŠâŸœdsÂ¨pairs
